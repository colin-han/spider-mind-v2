# doc-refactor

重构已确认的设计文档，优化结构和可读性。

## 用法

```
/doc-refactor <文档路径>
```

**示例**:
```
/doc-refactor docs/design/id-design.md
```

## 功能说明

分析现有文档的结构和内容，提出重构建议，目标：
- 提升文档的可读性和逻辑性
- 优化章节结构和信息组织
- 增强文档的可引用性（便于其他文档引用）
- 统一文档风格和格式

## 执行步骤

### 步骤 1: 多维度文档分析

从以下维度评估文档质量：

**A. 结构合理性**
- 章节组织是否符合逻辑
- 信息层次是否清晰
- 是否有冗余或重复的章节
- 目录结构深度是否合适

**B. 可读性**
- 语言是否清晰简洁
- 是否有过于抽象的描述
- 是否缺少必要的示例
- 示例代码是否过多（影响文档主体阅读）
- 格式是否统一

**C. 完整性**
- 是否缺少关键信息
- 是否有未定义的术语
- 是否缺少关键概念章节（本文档新设计的概念定义）
- 是否缺少必要的图表或示例
- 是否说明了设计的背景和原因

**D. 可引用性**
- 关键概念是否有清晰的定义
- 是否有"关键概念"章节（提供本文档特有概念的标准定义）
- 是否便于其他文档引用和智能匹配
- 章节 anchor 是否合理
- 关键概念的术语是否可以用于索引和搜索

**E. 维护性**
- 是否有版本历史
- 修改记录是否清晰
- 是否说明了相关文档
- 是否有所有者或负责人信息

### 步骤 2: 识别问题并分类

将发现的问题按优先级分类：

**🔴 结构性重构（高优先级）**
- 章节组织混乱，需要重新规划
- 缺少核心章节（如快速参考、使用示例）
- 信息层次不清晰

**🟡 内容补充（中优先级）**
- 缺少必要的示例或图表
- 示例代码过多，需要适度压缩
- 关键概念未充分说明
- 缺少设计背景或决策说明

**🟢 格式优化（低优先级）**
- 标题格式不统一
- 代码块缺少语言标记
- 表格格式需要优化

**💡 增强建议（可选）**
- 建议添加进阶内容
- 建议添加相关资源链接
- 建议添加 FAQ

### 步骤 3: 参考标准文档模板

**推荐的设计文档结构**（非强制，根据实际需求调整）：

```markdown
# [功能名称] 设计文档

## 元信息
- 作者：
- 创建日期：
- 最后更新：
- 相关文档：

## 关键概念
> 本节定义该设计文档引入的新概念，不包括外部库或其他文档已定义的概念。

| 概念 | 定义 | 示例/说明 |
|------|------|----------|
| [新概念1] | [该设计特有的概念定义] | [使用场景或示例] |
| [新概念2] | [该设计特有的概念定义] | [使用场景或示例] |

**原则**：
- 仅包含本文档新设计/引入的概念
- 外部库概念（如 Zustand、React）不应包含
- 其他设计文档已定义的概念应引用原文档
- 定义应聚焦于本设计的独特贡献

## 概述
[一段话说明这个设计的目的]

## 背景和动机
[为什么需要这个设计]

## 设计目标
- 目标1
- 目标2

## 快速参考（可选）
[常用的查询、代码片段等]

## 设计方案

### 架构概览
[架构图或数据流图]

### 详细设计
#### 数据模型
#### 接口定义
#### 核心逻辑

## 实现要点
[关键的实现注意事项]

## 使用示例
[精选的关键代码示例，避免过度展示]

## 设计决策
[重要的设计决策及理由]

## 替代方案（可选）
[考虑过但未采用的方案及原因]

## FAQ（可选）
[常见问题]

## 参考资料（可选）
[相关链接和资源]

## 修订历史
| 日期 | 版本 | 修改内容 | 作者 |
|------|------|---------|------|
```

**说明**：
- 这是一个参考模板，不是强制要求
- 可以根据文档的具体目标和内容调整章节
- 简单的设计可以省略某些章节
- 复杂的设计可以增加专门的章节
- **示例代码原则**：精而不多，每个示例应有明确目的，避免重复展示相似代码

### 步骤 4: 生成重构建议报告

报告包含：
- 当前文档结构分析
- 发现的问题（按优先级分类）
- **提取的关键概念**（本文档新设计的概念，用于索引和智能匹配）
- 建议的新文档结构
- 具体的修改建议
  - 包括示例代码的精简建议（保留核心示例，移除重复或过于详细的代码）
- 重构后的预期效果

**关键概念提取要求**：
- 仅提取本文档新设计/引入的概念
- 排除外部库（Zustand、React等）的概念
- 排除其他设计文档已定义的概念
- 标准化概念表达（例如：统一使用 "mindmap" 而非 "mind-map"）
- 这些概念将用于更新 `doc-draft-verify` 命令的智能匹配索引

报告保存到 `.claude/logs/refactor-reports/YYYY-MM-DD-<文档名>-refactor.md`

### 步骤 5: 等待确认

**重要**：重构建议仅供参考，不会自动修改文档。

建议的工作流程：
1. 审查重构建议报告
2. 与团队讨论是否采纳
3. 确认后，手动执行重构或请求 Claude 协助
4. 更新文档后，可运行 `/doc-verify` 验证一致性

---

## 示例代码管理原则

### 核心理念：少而精
- **每个示例都应有明确目的**：说明特定用法或概念
- **避免重复展示**：相似的代码模式只需展示一次
- **控制示例长度**：单个示例不超过 20-30 行
- **使用注释替代冗长代码**：用 `// ... 其他类似操作` 替代重复部分

### 建议的示例代码策略
1. **核心示例保留**：最基本、最常用的用法
2. **边界案例精简**：只展示关键差异点
3. **完整示例外置**：将完整示例代码链接到独立文件或附录
4. **使用表格总结**：多个相似操作可用表格替代多个代码块

---

## 关键概念的作用

### 1. 明确设计贡献
- 清晰标识本文档引入的新概念
- 区分自创概念与引用概念
- 帮助读者快速理解设计的核心创新

### 2. 支持智能匹配索引
关键概念将用于 `/doc-draft-verify` 命令的智能匹配功能：

**当前智能匹配规则**（基于草稿内容关键词）：
```
- 如涉及 ID 设计 → 对比 docs/design/id-design.md
- 如涉及类型定义 → 对比 docs/standard/coding-standards.md
- 如涉及项目结构 → 对比 docs/standard/project-structure.md
- 如涉及数据持久化 → 对比 docs/design/indexeddb-persistence-middleware-design.md
- 如涉及状态管理 → 对比 docs/design/mindmap-editor-store-design.md
```

**未来增强**（利用关键概念）：
- 从所有设计文档的"关键概念"章节提取新概念
- 构建 `概念 → 文档` 的映射索引
- 草稿校验时，基于草稿中的概念自动匹配相关文档
- 示例：草稿中出现 "order_index" → 自动匹配到相应设计文档

### 3. 跨文档引用
- 其他文档可以通过概念快速定位到原始定义
- 避免概念重复定义，保持一致性
- 便于追踪概念的演进和依赖关系

**建议**：
- 每个设计文档都应包含"关键概念"章节
- 仅包含本文档新设计的概念
- 外部概念应通过引用说明来源
