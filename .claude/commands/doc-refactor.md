# doc-refactor

重构已确认的设计文档，优化结构和可读性。

## 用法

```
/doc-refactor <文档路径>
```

**示例**:
```
/doc-refactor docs/design/id-design.md
```

## 功能说明

分析现有文档的结构和内容，提出重构建议，目标：
- 提升文档的可读性和逻辑性
- 优化章节结构和信息组织
- 增强文档的可引用性（便于其他文档引用）
- 统一文档风格和格式

## 执行步骤

### 步骤 1: 多维度文档分析

从以下维度评估文档质量：

**A. 结构合理性**
- 章节组织是否符合逻辑
- 信息层次是否清晰
- 是否有冗余或重复的章节
- 目录结构深度是否合适

**B. 可读性**
- 语言是否清晰简洁
- 是否有过于抽象的描述
- 是否缺少必要的示例
- 格式是否统一

**C. 完整性**
- 是否缺少关键信息
- 是否有未定义的术语
- 是否缺少名词解释章节（关键术语定义）
- 是否缺少必要的图表或示例
- 是否说明了设计的背景和原因

**D. 可引用性**
- 关键概念是否有清晰的定义
- 是否有"名词解释"章节（提供关键术语的标准定义）
- 是否便于其他文档引用和智能匹配
- 章节 anchor 是否合理
- 名词解释的术语是否可以用于索引和搜索

**E. 维护性**
- 是否有版本历史
- 修改记录是否清晰
- 是否说明了相关文档
- 是否有所有者或负责人信息

### 步骤 2: 识别问题并分类

将发现的问题按优先级分类：

**🔴 结构性重构（高优先级）**
- 章节组织混乱，需要重新规划
- 缺少核心章节（如快速参考、使用示例）
- 信息层次不清晰

**🟡 内容补充（中优先级）**
- 缺少必要的示例或图表
- 关键概念未充分说明
- 缺少设计背景或决策说明

**🟢 格式优化（低优先级）**
- 标题格式不统一
- 代码块缺少语言标记
- 表格格式需要优化

**💡 增强建议（可选）**
- 建议添加进阶内容
- 建议添加相关资源链接
- 建议添加 FAQ

### 步骤 3: 参考标准文档模板

**推荐的设计文档结构**（非强制，根据实际需求调整）：

```markdown
# [功能名称] 设计文档

## 元信息
- 作者：
- 创建日期：
- 最后更新：
- 相关文档：

## 名词解释
> 本节列出文档中的关键名词及其定义，便于理解和跨文档引用。

| 名词 | 定义 | 备注 |
|------|------|------|
| [关键术语1] | [简明定义] | [补充说明或使用场景] |
| [关键术语2] | [简明定义] | [补充说明或使用场景] |

**说明**：
- 仅列出本文档特定的或重要的术语
- 通用术语可引用项目统一术语表
- 定义应简洁明确，避免循环引用

## 概述
[一段话说明这个设计的目的]

## 背景和动机
[为什么需要这个设计]

## 设计目标
- 目标1
- 目标2

## 快速参考（可选）
[常用的查询、代码片段等]

## 设计方案

### 架构概览
[架构图或数据流图]

### 详细设计
#### 数据模型
#### 接口定义
#### 核心逻辑

## 实现要点
[关键的实现注意事项]

## 使用示例
[代码示例或使用示例]

## 设计决策
[重要的设计决策及理由]

## 替代方案（可选）
[考虑过但未采用的方案及原因]

## FAQ（可选）
[常见问题]

## 参考资料（可选）
[相关链接和资源]

## 修订历史
| 日期 | 版本 | 修改内容 | 作者 |
|------|------|---------|------|
```

**说明**：
- 这是一个参考模板，不是强制要求
- 可以根据文档的具体目标和内容调整章节
- 简单的设计可以省略某些章节
- 复杂的设计可以增加专门的章节

### 步骤 4: 生成重构建议报告

报告包含：
- 当前文档结构分析
- 发现的问题（按优先级分类）
- **提取的关键名词及定义**（用于索引和智能匹配）
- 建议的新文档结构
- 具体的修改建议
- 重构后的预期效果

**名词提取要求**：
- 从文档中提取所有关键术语及其定义
- 标准化术语表达（例如：统一使用 "mindmap" 而非 "mind-map"）
- 建议补充缺失的定义
- 这些名词将用于更新 `doc-draft-verify` 命令的智能匹配索引

报告保存到 `.claude/logs/refactor-reports/YYYY-MM-DD-<文档名>-refactor.md`

### 步骤 5: 等待确认

**重要**：重构建议仅供参考，不会自动修改文档。

建议的工作流程：
1. 审查重构建议报告
2. 与团队讨论是否采纳
3. 确认后，手动执行重构或请求 Claude 协助
4. 更新文档后，可运行 `/doc-verify` 验证一致性

---

## 名词解释的作用

### 1. 提升文档可读性
- 为新读者提供快速的术语参考
- 避免术语歧义和理解偏差
- 统一团队内部的术语使用

### 2. 支持智能匹配索引
名词解释中的术语将用于 `/doc-draft-verify` 命令的智能匹配功能：

**当前智能匹配规则**（基于草稿内容关键词）：
```
- 如涉及 ID 设计 → 对比 docs/design/id-design.md
- 如涉及类型定义 → 对比 docs/standard/coding-standards.md
- 如涉及项目结构 → 对比 docs/standard/project-structure.md
- 如涉及数据持久化 → 对比 docs/design/indexeddb-persistence-middleware-design.md
- 如涉及状态管理 → 对比 docs/design/mindmap-editor-store-design.md
```

**未来增强**（利用名词解释）：
- 从所有设计文档的"名词解释"章节提取术语
- 构建 `术语 → 文档` 的映射索引
- 草稿校验时，基于草稿中的术语自动匹配相关文档
- 示例：草稿中出现 "short_id" → 自动匹配到 `id-design.md`

### 3. 跨文档引用
- 其他文档可以通过术语快速定位到定义文档
- 减少重复定义，统一概念理解
- 便于构建文档知识图谱

**建议**：
- 每个设计文档都应包含"名词解释"章节
- 定期运行 `/doc-refactor` 提取和标准化术语
- 将提取的术语用于更新智能匹配索引
