# ID è®¾è®¡æ–‡æ¡£

## å…ƒä¿¡æ¯

- **ä½œè€…**: Colin Han
- **åˆ›å»ºæ—¥æœŸ**: 2024
- **æœ€åæ›´æ–°**: 2025-10-11
- **ç›¸å…³æ–‡æ¡£**:
  - ../standard/coding-standards.md
  - database-schema.md

## å…³é”®æ¦‚å¿µ

æœ¬èŠ‚å®šä¹‰è¯¥è®¾è®¡æ–‡æ¡£å¼•å…¥çš„æ–°æ¦‚å¿µã€‚

| æ¦‚å¿µ       | å®šä¹‰                                           | ç¤ºä¾‹/è¯´æ˜                           |
| ---------- | ---------------------------------------------- | ----------------------------------- |
| åŒIDæœºåˆ¶   | åŒä¸€å®ä½“ä½¿ç”¨UUIDå’Œshort_idä¸¤ç§æ ‡è¯†ç¬¦çš„è®¾è®¡æ¨¡å¼ | UUIDå†…éƒ¨ä½¿ç”¨ï¼Œshort_idå¯¹å¤–å±•ç¤º      |
| short_id   | 6å­—ç¬¦base36ç¼–ç çš„çŸ­æ ‡è¯†ç¬¦ï¼ŒèŒƒå›´å†…å”¯ä¸€          | å¦‚: "a1b2c3"                        |
| èŒƒå›´å”¯ä¸€æ€§ | IDä»…åœ¨ç‰¹å®šèŒƒå›´å†…ä¿è¯å”¯ä¸€ï¼Œè€Œéå…¨å±€å”¯ä¸€         | mindmap.short_idåœ¨user_idèŒƒå›´å†…å”¯ä¸€ |
| ç”¨æˆ·èŒƒå›´   | ä»¥user_idä¸ºè¾¹ç•Œçš„IDå”¯ä¸€æ€§èŒƒå›´                  | åŒä¸€ç”¨æˆ·çš„æ‰€æœ‰mindmapä¸é‡å¤         |
| å¯¼å›¾èŒƒå›´   | ä»¥mindmap_idä¸ºè¾¹ç•Œçš„IDå”¯ä¸€æ€§èŒƒå›´               | åŒä¸€å¯¼å›¾çš„æ‰€æœ‰èŠ‚ç‚¹ä¸é‡å¤            |

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº† Spider Mark V2 é¡¹ç›®ä¸­æ€ç»´å¯¼å›¾(mindmap)å’ŒèŠ‚ç‚¹(mindmap_node)çš„åŒ ID æœºåˆ¶è®¾è®¡ã€‚

é‡‡ç”¨ UUID ä½œä¸ºå†…éƒ¨ä¸»é”®,short_id ä½œä¸ºç”¨æˆ·å¯è§æ ‡è¯†ç¬¦,å¹³è¡¡äº†æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

## å¿«é€Ÿå‚è€ƒ

### ID è§„æ ¼é€ŸæŸ¥

| å®ä½“         | UUID ä¸»é”® | Short ID               | å”¯ä¸€æ€§èŒƒå›´        |
| ------------ | --------- | ---------------------- | ----------------- |
| mindmap      | id: uuid  | short_id: 6å­—ç¬¦ base36 | user_id èŒƒå›´å†…    |
| mindmap_node | id: uuid  | short_id: 6å­—ç¬¦ base36 | mindmap_id èŒƒå›´å†… |

### å¸¸ç”¨ SQL

```sql
-- é€šè¿‡ short_id æŸ¥è¯¢ mindmap
SELECT * FROM mindmaps
WHERE user_id = $1 AND short_id = $2;

-- é€šè¿‡ short_id æŸ¥è¯¢ mindmap_node
SELECT * FROM mindmap_nodes
WHERE mindmap_id = $1 AND short_id = $2;
```

### TypeScript ç±»å‹å®šä¹‰

```typescript
// lib/types/mindmap.ts
interface Mindmap {
  id: string; // UUID
  short_id: string; // 6å­—ç¬¦ base36
  user_id: string;
  // ...
}

interface MindmapNode {
  id: string; // UUID
  short_id: string; // 6å­—ç¬¦ base36
  mindmap_id: string;
  parent_id: string | null;
  // ...
}
```

## èƒŒæ™¯å’ŒåŠ¨æœº

### ä¸ºä»€ä¹ˆéœ€è¦åŒ ID æœºåˆ¶ï¼Ÿ

**ç”¨æˆ·ä½“éªŒéœ€æ±‚**:

- URL éœ€è¦ç®€çŸ­ã€æ˜“è¯»ã€æ˜“åˆ†äº«
- ç”¨æˆ·å¸Œæœ›çœ‹åˆ°å‹å¥½çš„ ID,è€Œä¸æ˜¯é•¿ä¸²çš„ UUID
- å†…å®¹å¼•ç”¨éœ€è¦ç®€æ´çš„æ ‡è¯†ç¬¦

**ç³»ç»Ÿæ€§èƒ½éœ€æ±‚**:

- æ•°æ®åº“éœ€è¦é«˜æ•ˆçš„ä¸»é”®(UUID æ€§èƒ½å¥½)
- éœ€è¦å¿«é€Ÿçš„ç´¢å¼•å’Œ join æ“ä½œ
- åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦å…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦

### ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å•ä¸€ IDï¼Ÿ

**ä»…ä½¿ç”¨ UUID**:

- âŒ URL è¿‡é•¿: `/@colin/550e8400-e29b-41d4-a716-446655440000`
- âŒ ç”¨æˆ·ä½“éªŒå·®,éš¾ä»¥è®°å¿†å’Œåˆ†äº«
- âŒ åœ¨ Markdown ä¸­å¼•ç”¨ä¸æ–¹ä¾¿

**ä»…ä½¿ç”¨ Short ID**:

- âŒ å…¨å±€å”¯ä¸€éœ€è¦æ›´é•¿çš„ ID(å†²çªé£é™©é«˜)
- âŒ æ•°æ®åº“æ€§èƒ½å¯èƒ½ä¸å¦‚ UUID
- âŒ åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç®¡ç†å¤æ‚

**åŒ ID æ–¹æ¡ˆ**:

- âœ… å†…éƒ¨ä½¿ç”¨ UUID(æ€§èƒ½ã€å”¯ä¸€æ€§)
- âœ… å¯¹å¤–ä½¿ç”¨ short_id(ç”¨æˆ·ä½“éªŒ)
- âœ… èŒƒå›´å”¯ä¸€å…è®¸ä½¿ç”¨æ›´çŸ­çš„ ID

## è®¾è®¡ç›®æ ‡

1. **å†…éƒ¨ä½¿ç”¨**: UUID ä½œä¸ºæ•°æ®åº“ä¸»é”®,ä¿è¯å…¨å±€å”¯ä¸€æ€§å’Œæ€§èƒ½
2. **ç”¨æˆ·å¯è§**: short_id ç”¨äº URL å’Œå†…å®¹å¼•ç”¨,æå‡ç”¨æˆ·ä½“éªŒ
3. **èŒƒå›´å”¯ä¸€**: short_id ä»…åœ¨ç‰¹å®šèŒƒå›´å†…å”¯ä¸€,å…è®¸ä½¿ç”¨æ›´çŸ­çš„æ ‡è¯†ç¬¦
4. **URL å‹å¥½**: æ”¯æŒç®€æ´ä¼˜é›…çš„ URL ç»“æ„

## åŒ ID æœºåˆ¶

### Mindmap ID

#### UUID (ä¸»é”®)

- **ç±»å‹**: `uuid`
- **ç”Ÿæˆ**: `gen_random_uuid()`
- **ç”¨é€”**: æ•°æ®åº“å†…éƒ¨ä¸»é”®,å¤–é”®å…³è”
- **ç¤ºä¾‹**: `550e8400-e29b-41d4-a716-446655440000`

#### Short ID (ç”¨æˆ·å¯è§)

- **ç±»å‹**: `text`
- **é•¿åº¦**: 6 å­—ç¬¦
- **å­—ç¬¦é›†**: base36 (å°å†™å­—æ¯ a-z + æ•°å­— 0-9)
- **å”¯ä¸€æ€§èŒƒå›´**: åœ¨åŒä¸€ç”¨æˆ·(user_id)èŒƒå›´å†…å”¯ä¸€
- **æ ¼å¼**: æ— å‰ç¼€,çº¯éšæœºå­—ç¬¦
- **ç¤ºä¾‹**: `abc123`, `x7k9m2`

### Mindmap Node ID

#### UUID (ä¸»é”®)

- **ç±»å‹**: `uuid`
- **ç”Ÿæˆ**: `gen_random_uuid()`
- **ç”¨é€”**: æ•°æ®åº“å†…éƒ¨ä¸»é”®,å¤–é”®å…³è”(å¦‚ parent_id)
- **ç¤ºä¾‹**: `6ba7b810-9dad-11d1-80b4-00c04fd430c8`

#### Short ID (ç”¨æˆ·å¯è§)

- **ç±»å‹**: `text`
- **é•¿åº¦**: 6 å­—ç¬¦
- **å­—ç¬¦é›†**: base36 (å°å†™å­—æ¯ a-z + æ•°å­— 0-9)
- **å”¯ä¸€æ€§èŒƒå›´**: åœ¨åŒä¸€ mindmap (mindmap_id) èŒƒå›´å†…å”¯ä¸€
- **æ ¼å¼**: æ— å‰ç¼€,çº¯éšæœºå­—ç¬¦
- **ç¤ºä¾‹**: `xyz789`, `a1b2c3`

## URL ç»“æ„

### URL æ¨¡å¼

```
/@{username}                                  -> ç”¨æˆ·ä¸»é¡µ
/@{username}/{map-short-id}                   -> æ€ç»´å¯¼å›¾é¡µé¢
/@{username}/{map-short-id}#{node-short-id}   -> å®šä½åˆ°ç‰¹å®šèŠ‚ç‚¹
```

### ç¤ºä¾‹

```
/@colin                    -> colin çš„ç”¨æˆ·ä¸»é¡µ
/@colin/abc123             -> colin çš„æ€ç»´å¯¼å›¾ abc123
/@colin/abc123#xyz789      -> å®šä½åˆ°èŠ‚ç‚¹ xyz789
```

### è·¯ç”±å‚æ•°

- `username`: ç”¨æˆ·å(3-20å­—ç¬¦,å°å†™å­—æ¯æ•°å­—å’Œè¿å­—ç¬¦)
- `map-short-id`: æ€ç»´å¯¼å›¾çš„ short_id (6å­—ç¬¦)
- `node-short-id`: èŠ‚ç‚¹çš„ short_id (6å­—ç¬¦,åœ¨ URL hash ä¸­)

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒå­—æ®µè¯´æ˜

åŒ ID æœºåˆ¶çš„æ ¸å¿ƒå­—æ®µï¼š

**mindmaps è¡¨**:

- `id` (uuid) - å†…éƒ¨ä¸»é”®ï¼Œç”¨äºå…³è”æŸ¥è¯¢å’Œå¤–é”®å¼•ç”¨
- `user_id` (uuid) - ç”¨æˆ· IDï¼Œå®šä¹‰ short_id çš„å”¯ä¸€æ€§èŒƒå›´
- `short_id` (text) - 6 å­—ç¬¦ç”¨æˆ·å¯è§ IDï¼Œåœ¨ user_id èŒƒå›´å†…å”¯ä¸€

**mindmap_nodes è¡¨**:

- `id` (uuid) - å†…éƒ¨ä¸»é”®ï¼Œç”¨äºå…³è”æŸ¥è¯¢å’Œå¤–é”®å¼•ç”¨
- `mindmap_id` (uuid) - æ‰€å±å¯¼å›¾ IDï¼Œå®šä¹‰ short_id çš„å”¯ä¸€æ€§èŒƒå›´
- `parent_id` (uuid) - çˆ¶èŠ‚ç‚¹ IDï¼Œç”¨äºæ„å»ºæ ‘å½¢ç»“æ„
- `short_id` (text) - 6 å­—ç¬¦ç”¨æˆ·å¯è§ IDï¼Œåœ¨ mindmap_id èŒƒå›´å†…å”¯ä¸€

> ğŸ“– **å®Œæ•´è¡¨ç»“æ„è¯·å‚è€ƒ**: [database-schema.md](./database-schema.md)
>
> åŒ…æ‹¬æ‰€æœ‰å­—æ®µå®šä¹‰ã€çº¦æŸã€ç´¢å¼•ã€è§¦å‘å™¨ç­‰è¯¦ç»†ä¿¡æ¯

### ID ç›¸å…³ç´¢å¼•

**å”¯ä¸€æ€§ä¿éšœ**:

- mindmaps è¡¨ï¼šå¤åˆå”¯ä¸€ç´¢å¼• `(user_id, short_id)` ç¡®ä¿ short_id åœ¨ç”¨æˆ·èŒƒå›´å†…å”¯ä¸€
- mindmap_nodes è¡¨ï¼šå¤åˆå”¯ä¸€ç´¢å¼• `(mindmap_id, short_id)` ç¡®ä¿ short_id åœ¨æ€ç»´å¯¼å›¾èŒƒå›´å†…å”¯ä¸€

**æŸ¥è¯¢æ€§èƒ½**:

- æ”¯æŒé€šè¿‡ `(user_id, short_id)` æˆ– `(mindmap_id, short_id)` çš„é«˜æ•ˆç»„åˆæŸ¥è¯¢
- ç´¢å¼•å·²æ˜¾å¼å‘½åï¼Œä¾¿äºè¿ç»´ç›‘æ§å’Œç®¡ç†

> ğŸ“– **å®Œæ•´ç´¢å¼•ç­–ç•¥è¯·å‚è€ƒ**: [database-schema.md](./database-schema.md#ç´¢å¼•ç­–ç•¥)
>
> åŒ…æ‹¬æ‰€æœ‰ç´¢å¼•å®šä¹‰ã€æ€§èƒ½ä¼˜åŒ–ç´¢å¼•ã€éƒ¨åˆ†ç´¢å¼•ç­‰è¯¦ç»†ä¿¡æ¯

## TypeScript ç±»å‹å®šä¹‰

```typescript
// lib/types/mindmap.ts
interface Mindmap {
  id: string;
  user_id: string;
  short_id: string;
  title: string;
  created_at: string;
  updated_at: string;
  deleted_at: string | null;
}

interface MindmapNode {
  id: string;
  mindmap_id: string;
  parent_id: string | null;
  short_id: string;
  created_at: string;
  updated_at: string;
}
```

## ä½¿ç”¨ç¤ºä¾‹

### Short ID ç”Ÿæˆ

**ç»Ÿä¸€æ–¹æ¡ˆ**ï¼š

- ä½¿ç”¨ `lib/utils/short-id.ts` ä¸­çš„ `generateShortId()` å·¥å…·å‡½æ•°
- åŸºäº nanoid åº“ï¼Œä½¿ç”¨ base36 å­—ç¬¦é›† (a-z0-9)
- è‡ªåŠ¨å¤„ç†ä¿ç•™è¯æ£€æŸ¥ï¼Œé¿å…å†²çª
- ç”Ÿæˆå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œç”±è°ƒç”¨æ–¹å¤„ç†

**å®ç°è¦ç‚¹**ï¼š

1. ç”Ÿæˆ 6 ä½éšæœºå­—ç¬¦
2. æ£€æŸ¥æ˜¯å¦ä¸ºä¿ç•™è¯
3. å¦‚æœæ˜¯ä¿ç•™è¯ï¼Œè‡ªåŠ¨é‡è¯•
4. è¶…è¿‡é‡è¯•æ¬¡æ•°æŠ›å‡ºå¼‚å¸¸

### ä¿ç•™è¯å¤„ç†

**ç­–ç•¥**ï¼š

- ä»…æ£€æŸ¥é•¿åº¦ä¸º 6 çš„ä¿ç•™è¯ï¼ˆä¸ short_id é•¿åº¦åŒ¹é…ï¼‰
- ä¿ç•™è¯åˆ—è¡¨å®šä¹‰åœ¨ `lib/constants/reserved-words.ts`
- ç”Ÿæˆæ—¶è‡ªåŠ¨é¿å¼€ï¼Œæ— éœ€è°ƒç”¨æ–¹å¤„ç†

**ä¿ç•™è¯ç±»åˆ«**ï¼š

- ç³»ç»Ÿè·¯ç”±ï¼šcreate, delete, system, config, update, remove
- å¸¸è§æ“ä½œï¼šexport, import, backup, upload, search
- ç”¨æˆ·ç›¸å…³ï¼šlogout, signup, signin, verify
- æƒé™çŠ¶æ€ï¼špublic, shared, secret, active, hidden, locked
- å…¶ä»–ï¼šfolder, static ç­‰

**å¤„ç†æœºåˆ¶**ï¼š

- ç”Ÿæˆæ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶é‡è¯•
- æå°æ¦‚ç‡è¿ç»­ç”Ÿæˆä¿ç•™è¯æ—¶æŠ›å‡ºå¼‚å¸¸
- è°ƒç”¨æ–¹éœ€è¦æ•è·å¼‚å¸¸å¹¶å¤„ç†

### æ•°æ®åº“æŸ¥è¯¢

```sql
-- é€šè¿‡ user_id å’Œ short_id æŸ¥è¯¢ mindmap
SELECT * FROM mindmaps
WHERE user_id = $1 AND short_id = $2;

-- è·å– mindmap çš„æ‰€æœ‰èŠ‚ç‚¹
SELECT * FROM mindmap_nodes
WHERE mindmap_id = $1
ORDER BY created_at;
```

### Markdown å¼•ç”¨è¯­æ³•

åœ¨èŠ‚ç‚¹çš„ content å­—æ®µä¸­,å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•å¼•ç”¨å…¶ä»–èŠ‚ç‚¹:

```markdown
# æ–¹å¼ 1: åŒæ–¹æ‹¬å·

å‚è€ƒ [[xyz789]] çš„å†…å®¹

# æ–¹å¼ 2: @ ç¬¦å·

å‚è€ƒ @xyz789 çš„åˆ†æ

# æ–¹å¼ 3: å¸¦æ ‡é¢˜(å¯é€‰)

å‚è€ƒ [[xyz789|èŠ‚ç‚¹æ ‡é¢˜]] çš„å†…å®¹
```

## è®¾è®¡å†³ç­–

### å†³ç­– 1: Short ID é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 6 å­—ç¬¦ï¼Ÿ

**è€ƒè™‘å› ç´ **:

- 4å­—ç¬¦: 36^4 = 1,679,616 (å†²çªé£é™©è¾ƒé«˜)
- 6å­—ç¬¦: 36^6 = 2,176,782,336 (å†²çªé£é™© < 0.023% for 1000 items)
- 8å­—ç¬¦: 36^8 = 2.8ä¸‡äº¿ (è¿‡äºå†—é•¿)

**å†³ç­–**: é€‰æ‹© 6 å­—ç¬¦

- å¹³è¡¡äº†ç®€æ´æ€§å’Œå”¯ä¸€æ€§
- å•ä¸ªç”¨æˆ· 1000 ä¸ª mindmap æ—¶å†²çªæ¦‚ç‡ä»ç„¶å¾ˆä½ (0.023%)
- URL ç®€çŸ­: `/@colin/abc123` vs `/@colin/abc12345`

**å‘½åç©ºé—´åˆ†æ**:

- æ€»ç©ºé—´: 36^6 = 2,176,782,336 (21äº¿+ç»„åˆ)
- 100 ä¸ªé¡¹ç›®: å†²çªæ¦‚ç‡ 0.0002%
- 1000 ä¸ªé¡¹ç›®: å†²çªæ¦‚ç‡ 0.023%

### å†³ç­– 2: ä¸ºä»€ä¹ˆä½¿ç”¨ base36 è€Œä¸æ˜¯ base62ï¼Ÿ

**base62**: åŒ…å«å¤§å°å†™å­—æ¯ + æ•°å­— (A-Za-z0-9)
**base36**: ä»…åŒ…å«å°å†™å­—æ¯ + æ•°å­— (a-z0-9)

**é€‰æ‹© base36 çš„åŸå› **:

- âœ… URL å‹å¥½(é¿å…å¤§å°å†™æ··æ·†)
- âœ… æ˜“äºé˜…è¯»å’Œå£è¿°
- âœ… é¿å… O/0, l/1/I ç­‰å®¹æ˜“æ··æ·†çš„å­—ç¬¦ç»„åˆ
- âœ… ç¬¦åˆ URL è§„èŒƒ(ä¸åŒºåˆ†å¤§å°å†™)
- âš ï¸ ç¼ºç‚¹: ç›¸åŒé•¿åº¦ä¸‹,å‘½åç©ºé—´æ¯” base62 å°

### å†³ç­– 3: èŒƒå›´å”¯ä¸€ vs å…¨å±€å”¯ä¸€

**é€‰æ‹©**: èŒƒå›´å”¯ä¸€

- mindmap.short_id åœ¨ user_id èŒƒå›´å†…å”¯ä¸€
- mindmap_node.short_id åœ¨ mindmap_id èŒƒå›´å†…å”¯ä¸€

**ç†ç”±**:

- å…è®¸ä½¿ç”¨æ›´çŸ­çš„ ID
- ç¬¦åˆæ•°æ®éš”ç¦»åŸåˆ™(ä¸åŒç”¨æˆ·çš„ ID å¯ä»¥é‡å¤)
- é™ä½å†²çªé£é™©
- URL ç»“æ„å·²ç»åŒ…å«èŒƒå›´ä¿¡æ¯(`/@username/short-id`)

### å†³ç­– 4: åº”ç”¨å±‚ç”Ÿæˆ vs æ•°æ®åº“ç”Ÿæˆ

**é€‰æ‹©**: åº”ç”¨å±‚ç”Ÿæˆ(ä½¿ç”¨ nanoid)

**ç†ç”±**:

- âœ… æ›´å¥½çš„æ§åˆ¶å’Œé”™è¯¯å¤„ç†
- âœ… å¯ä»¥å®ç°ä¿ç•™è¯è¿‡æ»¤
- âœ… å¯ä»¥å®ç°é‡è¯•æœºåˆ¶
- âœ… æ”¯æŒè‡ªå®šä¹‰å­—ç¬¦é›†å’Œé•¿åº¦
- âš ï¸ éœ€è¦åº”ç”¨å±‚æ£€æŸ¥å†²çª

### å†³ç­– 5: è½¯åˆ é™¤æ—¶ä¸å¤ç”¨ short_id

**é€‰æ‹©**: åˆ é™¤çš„ mindmap çš„ short_id ä¸å¤ç”¨

**ç†ç”±**:

- âœ… é¿å…ç”¨æˆ·æ··æ·†(æ—§é“¾æ¥ä¸ä¼šæŒ‡å‘æ–°å†…å®¹)
- âœ… ä¿æŒé“¾æ¥çš„ç¨³å®šæ€§
- âœ… ç®€åŒ–å®ç°(å”¯ä¸€çº¦æŸä¸éœ€è¦æ’é™¤å·²åˆ é™¤è®°å½•)
- âš ï¸ å¯èƒ½ä¼šç¼“æ…¢æ¶ˆè€—å‘½åç©ºé—´(ä½† 21äº¿ç»„åˆè¶³å¤Ÿä½¿ç”¨)

## å‘½åç©ºé—´åˆ†æ

### Mindmap Short ID

- **æ€»ç©ºé—´**: 36^6 = 2,176,782,336
- **èŒƒå›´**: å•ä¸ªç”¨æˆ·å†…
- **é¢„æœŸä½¿ç”¨é‡**: 100-1000 ä¸ª/ç”¨æˆ·
- **å†²çªæ¦‚ç‡**:
  - 100 ä¸ª: 0.0002%
  - 1000 ä¸ª: 0.023%

### Mindmap Node Short ID

- **æ€»ç©ºé—´**: 36^6 = 2,176,782,336
- **èŒƒå›´**: å•ä¸ª mindmap å†…
- **é¢„æœŸä½¿ç”¨é‡**: 100-1000 ä¸ªèŠ‚ç‚¹/å¯¼å›¾
- **å†²çªæ¦‚ç‡**:
  - 100 ä¸ª: 0.0002%
  - 1000 ä¸ª: 0.023%

## FAQ

### Q1: Short ID å†²çªäº†æ€ä¹ˆåŠï¼Ÿ

A:

1. æ•°æ®åº“çš„ UNIQUE çº¦æŸä¼šæ‹’ç»æ’å…¥
2. åº”ç”¨å±‚å®ç°é‡è¯•æœºåˆ¶(ç”Ÿæˆæ–°çš„ short_id)
3. å»ºè®®æœ€å¤šé‡è¯• 3 æ¬¡,ä»å¤±è´¥åˆ™è¿”å›é”™è¯¯ç»™ç”¨æˆ·

### Q2: Short ID å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå—ï¼Ÿ

A:

- å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒæ‰‹åŠ¨æŒ‡å®š
- æœªæ¥å¯ä»¥è€ƒè™‘æ·»åŠ è‡ªå®šä¹‰ short_id åŠŸèƒ½(å‚è€ƒ"æœªæ¥æ‰©å±•"ç« èŠ‚)
- å¦‚æœç¡®å®éœ€è¦,å¿…é¡»éªŒè¯:
  - é•¿åº¦ä¸º 6 å­—ç¬¦
  - ä»…åŒ…å« a-z0-9
  - åœ¨èŒƒå›´å†…å”¯ä¸€
  - ä¸æ˜¯ä¿ç•™è¯

### Q3: UUID å’Œ Short ID çš„æ˜ å°„å…³ç³»å¦‚ä½•ç»´æŠ¤ï¼Ÿ

A:

- å­˜å‚¨åœ¨åŒä¸€æ¡æ•°æ®åº“è®°å½•ä¸­
- UUID ç”¨äºå†…éƒ¨å…³è”(å¤–é”®,å¦‚ parent_id, mindmap_id)
- Short ID ç”¨äº URL å’Œç”¨æˆ·å¯è§åœºæ™¯
- æŸ¥è¯¢æ—¶é€šå¸¸éœ€è¦åŒæ—¶æä¾›èŒƒå›´æ ‡è¯†ç¬¦(user_id æˆ– mindmap_id)

### Q4: ä¸ºä»€ä¹ˆä¸ä½¿ç”¨è‡ªå¢ IDï¼Ÿ

A:

- âŒ è‡ªå¢ ID å®¹æ˜“è¢«çŒœæµ‹(å®‰å…¨é—®é¢˜)
- âŒ åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹è‡ªå¢ ID ç®¡ç†å¤æ‚
- âŒ æš´éœ²æ•°æ®è§„æ¨¡(å¦‚ id=5 è¯´æ˜åªæœ‰ 5 ä¸ª)
- âŒ å¤šæ•°æ®ä¸­å¿ƒåŒæ­¥å›°éš¾
- âœ… UUID æ›´é€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿ
- âœ… Short ID æä¾›äº†ç”¨æˆ·å‹å¥½æ€§

### Q5: è½¯åˆ é™¤çš„ mindmap çš„ short_id ä¼šè¢«å¤ç”¨å—ï¼Ÿ

A:

- ä¸ä¼šå¤ç”¨
- å”¯ä¸€çº¦æŸä¸æ’é™¤å·²åˆ é™¤çš„è®°å½•
- è¿™æ ·å¯ä»¥é¿å…æ—§é“¾æ¥æŒ‡å‘æ–°å†…å®¹,é€ æˆç”¨æˆ·æ··æ·†
- å‘½åç©ºé—´è¶³å¤Ÿå¤§(21äº¿),ä¸æ‹…å¿ƒè€—å°½

## å®‰å…¨è€ƒè™‘

### 1. å¼ºåˆ¶å°å†™

```sql
short_id text CHECK (short_id = lower(short_id))
username text CHECK (username = lower(username))
```

### 2. å”¯ä¸€æ€§çº¦æŸ

- æ•°æ®åº“å±‚é¢ä¿è¯å”¯ä¸€æ€§
- ä½¿ç”¨å¤åˆå”¯ä¸€ç´¢å¼•

### 3. è®¿é—®æ§åˆ¶

- é€šè¿‡ RLS (Row Level Security) ç­–ç•¥æ§åˆ¶è®¿é—®
- ä»…æ‹¥æœ‰è€…å¯ä»¥ä¿®æ”¹è‡ªå·±çš„ mindmaps å’Œ nodes
- å…¬å¼€åˆ†äº«éœ€è¦é¢å¤–çš„æƒé™æ§åˆ¶

### 4. é˜²æ­¢éå†

- Short ID ä½¿ç”¨éšæœºç”Ÿæˆ,æ— æ³•é¢„æµ‹
- ä¸ä½¿ç”¨è‡ªå¢ ID,é¿å…æš´éœ²æ•°æ®é‡
- å¯ä»¥é€šè¿‡ rate limiting é˜²æ­¢æš´åŠ›æšä¸¾

## æ€§èƒ½è€ƒè™‘

### 1. ç´¢å¼•ç­–ç•¥

**æ ¸å¿ƒ ID ç´¢å¼•**:

- å¤åˆå”¯ä¸€ç´¢å¼•: `(user_id, short_id)` å’Œ `(mindmap_id, short_id)` æ”¯æŒé«˜æ•ˆçš„ ID æŸ¥è¯¢

**å®Œæ•´ç´¢å¼•ç­–ç•¥**: å‚è§ [database-schema.md](./database-schema.md#ç´¢å¼•ç­–ç•¥)

### 2. æŸ¥è¯¢ä¼˜åŒ–

```sql
-- é«˜æ•ˆ: ä½¿ç”¨å¤åˆç´¢å¼•æŸ¥è¯¢ (user_id + short_id)
SELECT * FROM mindmaps
WHERE user_id = $1 AND short_id = $2;

-- ä½æ•ˆ: ä»…ä½¿ç”¨ short_id (éœ€è¦å…¨è¡¨æ‰«æ,å› ä¸º short_id ä¸æ˜¯ç´¢å¼•ç¬¬ä¸€åˆ—)
SELECT * FROM mindmaps
WHERE short_id = $1;

-- æ³¨æ„: å®é™…åº”ç”¨ä¸­é€šå¸¸å·²çŸ¥ user_id (ä»ä¼šè¯æˆ–è·¯ç”±å‚æ•°è·å–)
-- å¦‚æœç¡®å®éœ€è¦é€šè¿‡ username æŸ¥è¯¢,éœ€è¦å…ˆæŸ¥è¯¢ user_id:
-- 1. å…ˆè·å– user_id: SELECT id FROM user_profiles WHERE username = $1
-- 2. å†æŸ¥è¯¢ mindmap: SELECT * FROM mindmaps WHERE user_id = $1 AND short_id = $2
```

### 3. æ‰¹é‡æ“ä½œ

- è·å–æ€ç»´å¯¼å›¾æ—¶,æ‰¹é‡åŠ è½½æ‰€æœ‰èŠ‚ç‚¹
- ä½¿ç”¨ `mindmap_id` çš„ç´¢å¼•å¿«é€Ÿè¿‡æ»¤
- è€ƒè™‘ä½¿ç”¨ JOIN å‡å°‘æŸ¥è¯¢æ¬¡æ•°

## æœªæ¥æ‰©å±•

### 1. å…¬å¼€åˆ†äº«

å¦‚éœ€æ”¯æŒå…¬å¼€åˆ†äº«,å¯æ·»åŠ :

```sql
mindmaps:
  is_public boolean DEFAULT false
  share_token text UNIQUE  -- ç”¨äºç§å¯†åˆ†äº«
```

URL ç»“æ„:

```
/@{username}/{map-short-id}              -> å…¬å¼€è®¿é—®
/s/{share-token}                         -> ç§å¯†åˆ†äº«è®¿é—®
```

### 2. è‡ªå®šä¹‰ Short ID

å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ short_id (ç±»ä¼¼ GitHub repo å):

```sql
mindmaps:
  custom_short_id text
  is_custom_short_id boolean DEFAULT false
```

### 3. Short ID å†å²

å¦‚æœå…è®¸ä¿®æ”¹ short_id,éœ€è¦ä¿ç•™æ—§é“¾æ¥:

```sql
short_id_aliases:
  id uuid PRIMARY KEY
  mindmap_id uuid REFERENCES mindmaps(id)
  old_short_id text
  created_at timestamptz
```

## Username è®¾è®¡

ç”±äº URL ä½¿ç”¨ `/@{username}` æ ¼å¼,éœ€è¦å®šä¹‰ username è§„åˆ™:

### Profiles è¡¨

```sql
profiles:
  id uuid PRIMARY KEY REFERENCES auth.users(id)
  username text UNIQUE NOT NULL CHECK (username = lower(username))
```

### Username è§„åˆ™

- **é•¿åº¦**: 3-20 å­—ç¬¦
- **å­—ç¬¦é›†**: å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦
- **é™åˆ¶**: ä¸èƒ½ä»¥è¿å­—ç¬¦å¼€å¤´æˆ–ç»“å°¾
- **æ­£åˆ™**: `^[a-z0-9]([a-z0-9-]{1,18}[a-z0-9])?$`
- **ç¤ºä¾‹**: `colin`, `user-123`, `john-doe`

### ä¿ç•™ç”¨æˆ·å

```typescript
const RESERVED_USERNAMES = [
  "admin",
  "api",
  "auth",
  "settings",
  "about",
  "help",
  "support",
  "terms",
  "privacy",
];
```

## å‚è€ƒèµ„æ–™

- [nanoid](https://github.com/ai/nanoid) - ç”¨äºç”Ÿæˆ short_id
- [UUID Best Practices](https://www.postgresql.org/docs/current/datatype-uuid.html)
- [URL Design Best Practices](https://restfulapi.net/resource-naming/)

## ä¿®è®¢å†å²

| æ—¥æœŸ       | ç‰ˆæœ¬ | ä¿®æ”¹å†…å®¹                                                                        | ä½œè€…        |
| ---------- | ---- | ------------------------------------------------------------------------------- | ----------- |
| 2024       | 1.0  | åˆå§‹ç‰ˆæœ¬                                                                        | Colin Han   |
| 2025-10-04 | 2.0  | é‡æ„: æ·»åŠ å¿«é€Ÿå‚è€ƒã€èƒŒæ™¯å’ŒåŠ¨æœºã€è®¾è®¡å†³ç­–ã€FAQ ç« èŠ‚;ä¼˜åŒ–ç»“æ„å’Œæ ¼å¼               | Claude Code |
| 2025-10-07 | 2.1  | å¼ºè°ƒç»Ÿä¸€ä½¿ç”¨å·¥å…·å‡½æ•°ï¼›æ·»åŠ ä¿ç•™è¯æ£€æŸ¥æœºåˆ¶ï¼ˆä»…æ£€æŸ¥ 6 ä½ä¿ç•™è¯ï¼‰ï¼›ç²¾ç®€å®ç°ä»£ç ç¤ºä¾‹ | Claude      |
| 2025-10-11 | 2.2  | æ·»åŠ æ˜¾å¼å‘½åç´¢å¼•çš„å®ç°è¯´æ˜ï¼›æ¾„æ¸…ç´¢å¼•ä¸çº¦æŸå…±å­˜æœºåˆ¶                              | Claude      |
| 2025-10-11 | 2.3  | å®Œå–„æŸ¥è¯¢ç¤ºä¾‹,æ·»åŠ é€šè¿‡ username æŸ¥è¯¢çš„ JOIN ç¤ºä¾‹ï¼›ä¿®æ­£è¡¨åä¸º user_profiles       | Claude      |
| 2025-10-11 | 2.4  | é‡æ„æ•°æ®åº“è®¾è®¡ç« èŠ‚,æ”¹ä¸ºå¼•ç”¨ database-schema.mdï¼Œæ¶ˆé™¤é‡å¤å†…å®¹                    | Claude      |
| 2025-10-11 | 2.5  | ç®€åŒ–ç´¢å¼•è¯´æ˜,åˆ é™¤ SQL DDL ç»†èŠ‚,æ”¹ä¸ºå¼•ç”¨ database-schema.md                      | Claude      |
| 2025-10-11 | 2.6  | ç»Ÿä¸€æŸ¥è¯¢ç¤ºä¾‹ä½¿ç”¨ user_idï¼Œåˆ é™¤ username JOIN æŸ¥è¯¢                               | Claude      |
| 2025-11-06 | 2.7  | åˆ é™¤ MindmapNode.content å­—æ®µè¯´æ˜ï¼Œä¸æ•°æ®åº“ Schema ä¿æŒä¸€è‡´                     | Claude      |
