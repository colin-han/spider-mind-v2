# é¡¹ç›®ç»“æ„è¯´æ˜

è¿™ä¸ªæ–‡æ¡£è¯¦ç»†è¯´æ˜äº† Spider Mind v2 é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£é¡¹ç›®æ¶æ„ã€‚

## ğŸ“‚ æ•´ä½“ç»“æ„

```
spider-mind-v2/
â”œâ”€â”€ .claude/                    # Claude AI ç›¸å…³é…ç½®å’Œè§„èŒƒ
â”œâ”€â”€ .husky/                     # Git hooks é…ç½®
â”œâ”€â”€ __mocks__/                  # Jest æ¨¡æ‹Ÿæ–‡ä»¶
â”œâ”€â”€ __tests__/                  # å•å…ƒæµ‹è¯•å…¨å±€æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ app/                        # Next.js 13+ App Router åº”ç”¨ç›®å½•
â”œâ”€â”€ components/                 # React ç»„ä»¶ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç»„ï¼‰
â”œâ”€â”€ coverage/                   # æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ lib/                        # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œå·¥å…·
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”œâ”€â”€ playwright-report/          # Playwright æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ scripts/                    # å¼€å‘å’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ supabase/                   # æ•°æ®åº“è¿ç§»å’Œå‡½æ•°
â”œâ”€â”€ test-results/              # æµ‹è¯•è¿è¡Œç»“æœ
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶é›†åˆ
â””â”€â”€ é…ç½®æ–‡ä»¶...                 # å„ç§é…ç½®æ–‡ä»¶
```

## ğŸ“ æ ¸å¿ƒç›®å½•è¯¦è§£

### `/app` - Next.js App Router

```
app/
â”œâ”€â”€ (auth)/                     # è·¯ç”±ç»„: è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”œâ”€â”€ login/                  # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ signup/                 # æ³¨å†Œé¡µé¢
â”œâ”€â”€ dashboard/                  # ä»ªè¡¨æ¿é¡µé¢
â”œâ”€â”€ mindmaps/                   # æ€ç»´å¯¼å›¾ç›¸å…³é¡µé¢
â”‚   â””â”€â”€ [shortId]/             # åŠ¨æ€è·¯ç”±
â”œâ”€â”€ api/                        # API è·¯ç”±
â”‚   â”œâ”€â”€ auth/                   # è®¤è¯ API
â”‚   â””â”€â”€ nodes/                  # èŠ‚ç‚¹ç®¡ç† API
â”œâ”€â”€ globals.css                 # å…¨å±€æ ·å¼
â”œâ”€â”€ layout.tsx                  # æ ¹å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ loading.tsx                 # å…¨å±€åŠ è½½ç»„ä»¶
â”œâ”€â”€ not-found.tsx              # 404 é¡µé¢
â””â”€â”€ page.tsx                   # é¦–é¡µ
```

**èŒè´£:**

- å®šä¹‰åº”ç”¨çš„è·¯ç”±ç»“æ„
- åŒ…å«é¡µé¢ç»„ä»¶å’Œ API è·¯ç”±
- ä½¿ç”¨ Next.js 13+ çš„æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

**è§„èŒƒ:**

- é¡µé¢æ–‡ä»¶å¿…é¡»å‘½åä¸º `page.tsx`
- å¸ƒå±€æ–‡ä»¶å¿…é¡»å‘½åä¸º `layout.tsx`
- ä½¿ç”¨è·¯ç”±ç»„ `()` æ¥ç»„ç»‡ç›¸å…³é¡µé¢
- API è·¯ç”±ä½¿ç”¨ Route Handlers

### `/components` - React ç»„ä»¶

```
components/
â”œâ”€â”€ auth/                       # è®¤è¯ç›¸å…³ç»„ä»¶
â”œâ”€â”€ dashboard/                  # ä»ªè¡¨æ¿ç»„ä»¶
â”œâ”€â”€ mindmap/                    # æ€ç»´å¯¼å›¾ç»„ä»¶
â””â”€â”€ ui/                        # é€šç”¨ UI ç»„ä»¶
```

**èŒè´£:**

- æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸åœ¨ lib/ ä¸‹ï¼‰
- æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ç»„ä»¶
- æä¾›å¯å¤ç”¨çš„ UI ç»„ä»¶

**è§„èŒƒ:**

- ç»„ä»¶ä½¿ç”¨ PascalCase å‘½å
- æ–‡ä»¶ä½¿ç”¨ kebab-case å‘½åï¼ˆå¦‚ `mindmap-node.tsx`ï¼‰
- æ¯ä¸ªç»„ä»¶ç›®å½•å¯åŒ…å«ç»„ä»¶æ–‡ä»¶å’Œç›¸å…³æ ·å¼

### `/lib` - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œå·¥å…·

```
lib/
â”œâ”€â”€ actions/                    # Server Actionsï¼ˆNext.js æœåŠ¡ç«¯æ“ä½œï¼‰
â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰ React Hooks
â”œâ”€â”€ providers/                  # React Context Providers
â”œâ”€â”€ store/                      # Zustand çŠ¶æ€ç®¡ç†
â”œâ”€â”€ supabase/                   # Supabase å®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ types/                      # TypeScript ç±»å‹å®šä¹‰
â””â”€â”€ utils/                      # å·¥å…·å‡½æ•°
```

**èŒè´£:**

- ç®¡ç†åº”ç”¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- æä¾›æ•°æ®è®¿é—®å±‚å’ŒçŠ¶æ€ç®¡ç†
- å®šä¹‰åº”ç”¨çš„ç±»å‹ç³»ç»Ÿ
- æä¾›å·¥å…·å‡½æ•°å’Œè‡ªå®šä¹‰ hooks

**è§„èŒƒ:**

- æ‰€æœ‰å¯¼å‡ºä½¿ç”¨å‘½åå¯¼å‡ºï¼Œé¿å…é»˜è®¤å¯¼å‡º
- hooks ä½¿ç”¨ camelCase å¹¶ä»¥ `use` å¼€å¤´
- å·¥å…·å‡½æ•°ä½¿ç”¨ camelCase å‘½å
- Server Actions æ”¾åœ¨ `actions/` ç›®å½•

### `/tests` - æµ‹è¯•æ–‡ä»¶

```
tests/
â”œâ”€â”€ e2e/                        # End-to-End æµ‹è¯•
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢å¯¹è±¡æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ BasePage.ts         # é¡µé¢å¯¹è±¡åŸºç±»
â”‚   â”‚   â””â”€â”€ HomePage.ts         # é¦–é¡µé¡µé¢å¯¹è±¡
â”‚   â”œâ”€â”€ fixtures.ts             # æµ‹è¯•å›ºä»¶å’Œå·¥å…·
â”‚   â”œâ”€â”€ config.ts               # E2E æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ global-setup.ts         # å…¨å±€æµ‹è¯•è®¾ç½®
â”‚   â”œâ”€â”€ global-teardown.ts      # å…¨å±€æµ‹è¯•æ¸…ç†
â”‚   â””â”€â”€ *.spec.ts              # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ integration/               # é›†æˆæµ‹è¯•
â”œâ”€â”€ setup/                     # æµ‹è¯•è®¾ç½®æ–‡ä»¶
â””â”€â”€ unit/                      # å•å…ƒæµ‹è¯• (å¦‚æœéœ€è¦ç‹¬ç«‹ç›®å½•)
```

**èŒè´£:**

- åŒ…å«æ‰€æœ‰ç±»å‹çš„æµ‹è¯•æ–‡ä»¶
- æä¾›æµ‹è¯•å·¥å…·å’Œé…ç½®
- ä½¿ç”¨é¡µé¢å¯¹è±¡æ¨¡å¼ç»„ç»‡ E2E æµ‹è¯•

**è§„èŒƒ:**

- E2E æµ‹è¯•ä½¿ç”¨ `.spec.ts` åç¼€
- å•å…ƒæµ‹è¯•ä½¿ç”¨ `.test.ts` åç¼€
- é¡µé¢å¯¹è±¡ä½¿ç”¨ PascalCase å‘½åå¹¶ç»§æ‰¿ `BasePage`

### `/supabase` - æ•°æ®åº“å’Œåç«¯åŠŸèƒ½

```
supabase/
â”œâ”€â”€ migrations/                 # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ functions/                  # Edge Functionsï¼ˆServerless å‡½æ•°ï¼‰
â””â”€â”€ seed.sql                   # æ•°æ®åº“ç§å­æ•°æ®ï¼ˆå¦‚æœ‰ï¼‰
```

**èŒè´£:**

- ç®¡ç†æ•°æ®åº“ schema å’Œè¿ç§»
- å®šä¹‰ Edge Functions
- æä¾›æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

**è§„èŒƒ:**

- è¿ç§»æ–‡ä»¶æŒ‰æ—¶é—´æˆ³å‘½å
- Functions ä½¿ç”¨ TypeScript ç¼–å†™
- éµå¾ª Supabase æœ€ä½³å®è·µ

### `/scripts` - å¼€å‘è„šæœ¬

```
scripts/
â”œâ”€â”€ dev-setup.sh               # å¼€å‘ç¯å¢ƒè®¾ç½®è„šæœ¬
â”œâ”€â”€ check-env.js               # ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â””â”€â”€ build-scripts/             # æ„å»ºç›¸å…³è„šæœ¬
```

**èŒè´£:**

- è‡ªåŠ¨åŒ–å¼€å‘ç¯å¢ƒè®¾ç½®
- æä¾›å¼€å‘å’Œéƒ¨ç½²å·¥å…·
- ç¯å¢ƒæ£€æŸ¥å’ŒéªŒè¯

### `/docs` - é¡¹ç›®æ–‡æ¡£

```
docs/
â”œâ”€â”€ project-structure.md       # é¡¹ç›®ç»“æ„è¯´æ˜ (æœ¬æ–‡æ¡£)
â”œâ”€â”€ development-guide.md       # å¼€å‘ç¯å¢ƒæŒ‡å—
â”œâ”€â”€ coding-standards.md        # ä»£ç è§„èŒƒæ–‡æ¡£
â””â”€â”€ api/                       # API æ–‡æ¡£
```

**èŒè´£:**

- æä¾›é¡¹ç›®å¼€å‘æŒ‡å—
- ç»´æŠ¤æŠ€æœ¯æ–‡æ¡£å’Œè§„èŒƒ
- è®°å½•æ¶æ„å†³ç­–å’Œæœ€ä½³å®è·µ

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

| æ–‡ä»¶                 | ç”¨é€”                |
| -------------------- | ------------------- |
| `package.json`       | é¡¹ç›®ä¾èµ–å’Œè„šæœ¬å®šä¹‰  |
| `tsconfig.json`      | TypeScript ç¼–è¯‘é…ç½® |
| `next.config.js`     | Next.js æ¡†æ¶é…ç½®    |
| `tailwind.config.ts` | Tailwind CSS é…ç½®   |
| `postcss.config.mjs` | PostCSS é…ç½®        |
| `middleware.ts`      | Next.js ä¸­é—´ä»¶      |
| `.env.local`         | æœ¬åœ°ç¯å¢ƒå˜é‡é…ç½®    |
| `.env.example`       | ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶    |

### ä»£ç è´¨é‡é…ç½®

| æ–‡ä»¶                   | ç”¨é€”                    |
| ---------------------- | ----------------------- |
| `.eslintrc.json`       | ESLint ä»£ç æ£€æŸ¥è§„åˆ™     |
| `.prettierrc`          | Prettier ä»£ç æ ¼å¼åŒ–è§„åˆ™ |
| `jest.config.js`       | Jest å•å…ƒæµ‹è¯•é…ç½®       |
| `playwright.config.ts` | Playwright E2E æµ‹è¯•é…ç½® |

### Git å’Œ CI/CD

| æ–‡ä»¶          | ç”¨é€”               |
| ------------- | ------------------ |
| `.gitignore`  | Git å¿½ç•¥æ–‡ä»¶é…ç½®   |
| `.husky/`     | Git hooks é…ç½®ç›®å½• |
| `lint-staged` | é¢„æäº¤ä»£ç æ£€æŸ¥é…ç½® |

## ğŸ“‹ æ–‡ä»¶å‘½åè§„èŒƒ

### ç»„ä»¶æ–‡ä»¶

- **React ç»„ä»¶æ–‡ä»¶**: kebab-case (`user-profile.tsx`, `mindmap-node.tsx`)
- **React ç»„ä»¶å¯¼å‡º**: PascalCase (`export function UserProfile()`)
- **é¡µé¢ç»„ä»¶**: `page.tsx` (Next.js App Router çº¦å®š)
- **å¸ƒå±€ç»„ä»¶**: `layout.tsx` (Next.js App Router çº¦å®š)

### å·¥å…·å’Œé…ç½®æ–‡ä»¶

- **å·¥å…·å‡½æ•°æ–‡ä»¶**: kebab-case (`format-date.ts`, `cn.ts`)
- **å·¥å…·å‡½æ•°å¯¼å‡º**: camelCase (`export function formatDate()`)
- **å¸¸é‡æ–‡ä»¶**: kebab-case (`api-constants.ts`)
- **é…ç½®æ–‡ä»¶**: kebab-case (`api-config.ts`)

### æµ‹è¯•æ–‡ä»¶

- **å•å…ƒæµ‹è¯•**: `*.test.ts` æˆ– `*.test.tsx`
- **E2E æµ‹è¯•**: `*.spec.ts`
- **é¡µé¢å¯¹è±¡**: PascalCase (`LoginPage.ts`)

## ğŸš€ æ·»åŠ æ–°åŠŸèƒ½æŒ‡å—

### 1. æ·»åŠ æ–°é¡µé¢

1. åœ¨ `app/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±ç›®å½•
2. æ·»åŠ  `page.tsx` æ–‡ä»¶
3. å¦‚éœ€è¦ï¼Œæ·»åŠ å¯¹åº”çš„ `layout.tsx`
4. åœ¨ `tests/e2e/pages/` ä¸‹åˆ›å»ºé¡µé¢å¯¹è±¡
5. ç¼–å†™å¯¹åº”çš„ E2E æµ‹è¯•

### 2. æ·»åŠ æ–°ç»„ä»¶

1. åœ¨ `components/` ç›¸åº”åˆ†ç±»ä¸‹åˆ›å»ºç»„ä»¶æ–‡ä»¶ï¼ˆä½¿ç”¨ kebab-case å‘½åï¼‰
2. ç¼–å†™ç»„ä»¶çš„ TypeScript ç±»å‹å®šä¹‰
3. æ·»åŠ å•å…ƒæµ‹è¯•æ–‡ä»¶
4. æ›´æ–°ç›¸å…³çš„é¡µé¢æˆ–çˆ¶ç»„ä»¶

### 3. æ·»åŠ æ–°çš„ API è·¯ç”±

1. åœ¨ `app/api/` ä¸‹åˆ›å»ºè·¯ç”±ç›®å½•
2. æ·»åŠ  `route.ts` æ–‡ä»¶å®ç° Route Handler
3. åœ¨ `lib/services/` ä¸­åˆ›å»ºå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡
4. æ·»åŠ  API é›†æˆæµ‹è¯•

### 4. æ·»åŠ æ–°çš„å·¥å…·å‡½æ•°

1. åœ¨ `lib/utils/` ä¸­åˆ›å»ºå·¥å…·æ–‡ä»¶
2. ç¼–å†™å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
3. æ·»åŠ å•å…ƒæµ‹è¯•
4. æ›´æ–°å¯¼å‡ºç´¢å¼•æ–‡ä»¶

## ğŸ¯ æœ€ä½³å®è·µ

### å¯¼å…¥é¡ºåº

```typescript
// 1. React/Next.js æ ¸å¿ƒ
import React from "react";
import { NextRequest } from "next/server";

// 2. ç¬¬ä¸‰æ–¹åº“
import { z } from "zod";
import { clsx } from "clsx";
import { twMerge } from "tailwind-merge";

// 3. å†…éƒ¨ç»„ä»¶å’Œå·¥å…· (æŒ‰å±‚çº§ä»é«˜åˆ°ä½)
import { Button } from "@/components/ui/button";
import { MindmapNode } from "@/components/mindmap/mindmap-node";
import { useAuth } from "@/lib/hooks/use-auth";
import { cn } from "@/lib/utils/cn";

// 4. ç±»å‹å¯¼å…¥ (ä½¿ç”¨ type å…³é”®å­—)
import type { User } from "@/lib/types/auth";
```

### æ–‡ä»¶ç»„ç»‡

- ç›¸å…³æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹
- ä½¿ç”¨ `index.ts` æ–‡ä»¶å¯¼å‡ºç›®å½•å†…å®¹
- é¿å…æ·±å±‚åµŒå¥—ï¼Œä¿æŒç›®å½•ç»“æ„æ‰å¹³åŒ–
- æŒ‰åŠŸèƒ½è€Œéæ–‡ä»¶ç±»å‹ç»„ç»‡ä»£ç 

### TypeScript ä½¿ç”¨

- ä¸ºæ‰€æœ‰å‡½æ•°å’Œç»„ä»¶æä¾›æ˜ç¡®çš„ç±»å‹å®šä¹‰
- ä½¿ç”¨ `interface` å®šä¹‰å¯¹è±¡ç»“æ„
- ä½¿ç”¨ `type` å®šä¹‰è”åˆç±»å‹å’Œå¤æ‚ç±»å‹
- é¿å…ä½¿ç”¨ `any` ç±»å‹

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœå¯¹é¡¹ç›®ç»“æ„æœ‰ç–‘é—®ï¼Œå¯ä»¥ï¼š

1. æŸ¥é˜…ç›¸å…³æ–‡æ¡£æ–‡ä»¶
2. è¿è¡Œ `yarn dev:check` æ£€æŸ¥ç¯å¢ƒé…ç½®
3. æŸ¥çœ‹ç°æœ‰ä»£ç çš„å®ç°æ–¹å¼
4. å‚è€ƒæµ‹è¯•æ–‡ä»¶äº†è§£ç»„ä»¶ä½¿ç”¨æ–¹æ³•

---

_æœ¬æ–‡æ¡£ä¼šéšç€é¡¹ç›®æ¼”è¿›æŒç»­æ›´æ–°ï¼Œè¯·å®šæœŸæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ã€‚_
